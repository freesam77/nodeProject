<%- include('includes/head.ejs') %>
<h1>Mailing List</h1>
<% if (emailList && emailList.length) { %>
<table id="user-table">
  <tr>
    <th>No</th>
    <% Object.keys(emailList[0]).map(key => { %>
    <th><%= key %></th>
    <% }) %>
    <th>Action</th>
  </tr>
  <% emailList.map((user, id) => { %>
  <tr>
    <td><%= id+1 %></td>
    <% Object.values(user).map(val => { %>
    <td><%= val %></td>
    <% }) %>
    <td>
      <form action="/mailing-list/delete/<%= user._id %>" method="POST">
        <input type="hidden" name="id" value="<%= user._id %>" />
        <button type="submit" onclick="deletePrompt(event)" class="delete">
          ðŸ—‘ Remove
        </button>
      </form>
    </t>
  </tr>
  <% }) %>
</table>
<% } else { %>
<h2>No mails in the list!</h2>
<% } %>
<script>
  const deletePrompt = (e) => {
    const answer = confirm(
      'Are you sure to remove this user from the mailing list?'
    );
    if (!answer) {
      e.preventDefault();
    }
  };
</script>
<%- include('includes/end.ejs') %>
